<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="hr.system.p0001">
	<resultMap id="p0001Result01" type="sawonVO">
		<result property="PK_SAWON_CODE" column="PK_SAWON_CODE" />
		<result property="SAWON_NAME" column="SAWON_NAME" />
		<result property="SAWON_ENG_NAME" column="SAWON_JOIN_DATE" />
		<result property="SAWON_RESIGNATION_DATE" column="SAWON_RESIGNATION_DATE" />
		<result property="SAWON_USER_STATUS" column="SAWON_USER_STATUS" />
		<result property="SAWON_PASSWORD" column="SAWON_PASSWORD" />
		<result property="SAWON_VIEW_PERMISSION" column="SAWON_VIEW_PERMISSION" />
		<result property="SAWON_EMERGENCY_CON_NET" column="SAWON_EMERGENCY_CON_NET" />
		<result property="FK_DEPT_CODE" column="FK_DEPT_CODE" />
		<result property="SAWON_INT_USER_ID" column="SAWON_INT_USER_ID" />
		<result property="SAWON_INT_DATE" column="SAWON_INT_DATE" />
		<result property="SAWON_MOD_USER_ID" column="SAWON_MOD_USER_ID" />
		<result property="SAWON_MOD_DATE" column="SAWON_MOD_DATE" />
	</resultMap>
	
	<select id="selectMember4Login" parameterType="hr.system.p0001.vo.LoginVO" resultType="hr.system.p0001.vo.SawonVO" >
        SELECT PK_SAWON_CODE, SAWON_NAME, SAWON_VIEW_PERMISSION
          FROM SAWON 
         WHERE SAWON_USER_STATUS='Y' 
           AND PK_SAWON_CODE = #{ PK_SAWON_CODE } AND SAWON_PASSWORD = #{ SAWON_PASSWORD }
    </select> 
    
    <insert id="insertLogIn" parameterType="String">
    	INSERT INTO COM_LOGINOUT (LNO, USERNO, LTYPE, LDATE)
    	 	              VALUES ((SELECT NVL(MAX(LNO)+1,0) FROM COM_LOGINOUT), #{ PK_SAWON_CODE }, 'I', to_char(sysdate,'yyyy.mm.dd hh24:mi') )
    </insert>

    <insert id="insertLogOut" parameterType="String">
    	INSERT INTO COM_LOGINOUT (LNO, USERNO, LTYPE, LDATE)
    	 	              VALUES ((SELECT NVL(MAX(LNO)+1,0) FROM COM_LOGINOUT), #{ PK_SAWON_CODE }, 'O', to_char(sysdate,'yyyy.mm.dd hh24:mi') )
    </insert>
    
    <sql id="includeSignDocType">
        WHERE DOCTYPE_DELETEFLAG='N'
        <if test="searchKeyword!=null and searchKeyword!='' and searchType!=''">
            <foreach item="item" index="index" collection="searchTypeArr" separator=" OR " open="AND (" close=")">
                 ${item} LIKE CONCAT('%', #{searchKeyword},'%' )
            </foreach>
        </if>               
    </sql>

    <select id="selectSignDocTypeCount" resultType="Integer" parameterType="project.common.SearchVO">
        SELECT COUNT(*)
          FROM DOCTYPE SDT
         <include refid="includeSignDocType"/>
    </select>
    
    <sql id="includeCode">
        WHERE 1=1
        <if test="searchKeyword!=null and searchKeyword!='' and searchType!=''">
            <foreach item="item" index="index" collection="searchTypeArr" separator=" OR " open="AND (" close=")">
                 ${item} LIKE CONCAT('%', #{searchKeyword},'%' )
            </foreach>
        </if>               
    </sql> 
    
    <select id="selectSignDocTypeList" resultType="hr.system.p0001.vo.SignDocTypeVO" parameterType="project.common.SearchVO">
        SELECT PK_DOCTYPE_NUM, DOCTYPE_DTTITLE, DOCTYPE_DTCONTENTS, DOCTYPE_DELETEFLAG
		FROM (SELECT ROWNUM as NO, PK_DOCTYPE_NUM, DOCTYPE_DTTITLE, DOCTYPE_DTCONTENTS, DOCTYPE_DELETEFLAG
		      FROM DOCTYPE SDT
		      ORDER by PK_DOCTYPE_NUM DESC) A
		<include refid="includeCode"/>
      	<if test="rowStart != null">
			AND NO BETWEEN ${rowStart-1} AND ${rowStart+9}
         </if>
          AND DOCTYPE_DELETEFLAG='N'
    </select> 

    <insert id="insertSignDocType" parameterType="java.util.Map" >
        INSERT INTO DOCTYPE(PK_DOCTYPE_NUM, DOCTYPE_DTTITLE, DOCTYPE_DTCONTENTS, DOCTYPE_DELETEFLAG, DOCTYPE_INT_USER_ID, DOCTYPE_INT_DATE)
        VALUES ((SELECT NVL(MAX(PK_DOCTYPE_NUM)+1,0) FROM DOCTYPE), #{DOCTYPE_DTTITLE}, #{DOCTYPE_DTCONTENTS}, 'N', #{PK_SAWON_CODE}, to_char(sysdate,'yyyy.mm.dd hh24:mi'))
    </insert>
    
    <update id="updateSignDocType" parameterType="java.util.Map">
        UPDATE DOCTYPE
           SET DOCTYPE_DTTITLE=#{DOCTYPE_DTTITLE}, DOCTYPE_DTCONTENTS=#{DOCTYPE_DTCONTENTS}, DOCTYPE_MOD_USER_ID=#{PK_SAWON_CODE}, DOCTYPE_MOD_DATE=to_char(sysdate,'yyyy.mm.dd hh24:mi')
         WHERE PK_DOCTYPE_NUM=#{PK_DOCTYPE_NUM} 
    </update> 
        
    <select id="selectSignDocTypeOne" parameterType="hr.system.p0001.vo.SignDocTypeVO" resultType="hr.system.p0001.vo.SignDocTypeVO">
        SELECT PK_DOCTYPE_NUM, DOCTYPE_DTTITLE, DOCTYPE_DTCONTENTS
          FROM DOCTYPE SDT
         WHERE DOCTYPE_DELETEFLAG='N' AND PK_DOCTYPE_NUM=#{PK_DOCTYPE_NUM}
    </select> 
    
    <delete id="deleteSignDocType" parameterType="hr.system.p0001.vo.SignDocTypeVO">
        UPDATE DOCTYPE
           SET DOCTYPE_DELETEFLAG='Y'
         WHERE PK_DOCTYPE_NUM=#{PK_DOCTYPE_NUM} 
    </delete>

	<select id="searchList" resultMap="p0001Result01" parameterType="java.util.Map"> 
      <![CDATA[
         SELECT 
		    PK_SAWON_CODE,
		    SAWON_NAME,
		    SAWON_ENG_NAME,
		    SAWON_JOIN_DATE,
		    SAWON_RESIGNATION_DATE,
		    SAWON_USER_STATUS,
		    SAWON_PASSWORD,
		    SAWON_VIEW_PERMISSION,
		    SAWON_EMERGENCY_CON_NET,
		    FK_DEPT_CODE,
		    SAWON_INT_USER_ID,
		    SAWON_INT_DATE,
		    SAWON_MOD_USER_ID,
		    SAWON_MOD_DATE
		FROM SAWON;
      ]]>
		<where>
			<if test=" p_id != ''  and  p_id != null">
				PK_SAWON_CODE = #{p_id}
			</if>
		</where>
	</select>

</mapper>